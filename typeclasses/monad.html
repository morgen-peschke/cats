<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Laika 0.18.1 + Helium Theme" />
    <title>Monad</title>
    
      <meta name="author" content="Cody Allen"/>
    
      <meta name="author" content="Ross Baker"/>
    
      <meta name="author" content="Arman Bilge"/>
    
      <meta name="author" content="P. Oscar Boykin"/>
    
      <meta name="author" content="Travis Brown"/>
    
      <meta name="author" content="Adelbert Chang"/>
    
      <meta name="author" content="Daniel Esik"/>
    
      <meta name="author" content="Peter Neyens"/>
    
      <meta name="author" content="Rob Norris"/>
    
      <meta name="author" content="Erik Osheim"/>
    
      <meta name="author" content="LukaJCB"/>
    
      <meta name="author" content="Michael Pilquist"/>
    
      <meta name="author" content="Miles Sabin"/>
    
      <meta name="author" content="Daniel Spiewak"/>
    
      <meta name="author" content="Frank Thomas"/>
    
      <meta name="author" content="Sergey Torgashov"/>
    
      <meta name="author" content="Julien Truffaut"/>
    
      <meta name="author" content="Kailuo Wang"/>
    
    
      <meta name="description" content="docs"/>
    
    
      <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
    
    <link rel="stylesheet" type="text/css" href="../helium/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../helium/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../site/styles.css" />
    <script src="../helium/laika-helium.js"></script>
    <script src="../js/sponsors.js"></script>
    
    
    <script> /* for avoiding page load transitions */ </script>
  </head>

  <body>

    <header id="top-bar">

      <div class="row">
        <a id="nav-icon">
          <i class="icofont-laika" title="Navigation">&#xefa2;</i>
        </a>
        
      </div>

      <a class="image-link" href="https://typelevel.org"><img src="https://typelevel.org/img/logo.svg"></a>

      <span class="row links"><a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/cats-docs_2.13/1.6.0/"><span title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a><a class="icon-link svg-link" href="https://github.com/morgen-peschke/cats"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a><a class="icon-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika" title="Chat">&#xeed5;</i></a><a class="icon-link" href="https://twitter.com/typelevel"><i class="icofont-laika" title="Twitter">&#xed7a;</i></a></span>

    </header>

    <nav id="sidebar">

      <div class="row">
        <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/cats-docs_2.13/1.6.0/"><span title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a><a class="icon-link svg-link" href="https://github.com/morgen-peschke/cats"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a><a class="icon-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika" title="Chat">&#xeed5;</i></a><a class="icon-link" href="https://twitter.com/typelevel"><i class="icofont-laika" title="Twitter">&#xed7a;</i></a>
      </div>

      <ul class="nav-list">
        <li class="level1"><a href="../index.html">Cats</a></li>
        <li class="level1"><a href="../typeclasses.html">Type Classes</a></li>
        <li class="level1"><a href="../datatypes.html">Data Types</a></li>
        <li class="level1"><a href="../algebra.html">Algebra</a></li>
        <li class="level1"><a href="../alleycats.html">Alleycats</a></li>
        <li class="level1"><a href="../motivations.html">Motivations</a></li>
        <li class="level1"><a href="../resources_for_learners.html">Resources for Learners</a></li>
        <li class="level1"><a href="../jump_start_guide.html">Jump Start Guide</a></li>
        <li class="level1"><a href="../imports.html">Imports</a></li>
        <li class="level1"><a href="../faq.html">FAQ</a></li>
        <li class="level1"><a href="../CONTRIBUTING.html">Contributor guide</a></li>
        <li class="level1"><a href="../ADOPTERS.html">Adopters</a></li>
        <li class="level1"><a href="../colophon.html">Colophon</a></li>
        <li class="level1"><a href="../nomenclature.html">Glossary</a></li>
        <li class="level1"><a href="../guidelines.html">Guidelines</a></li>
        <li class="level1"><a href="../typelevelEcosystem.html">Typelevel Ecosystem</a></li>
        <li class="level1 nav-header">Type Classes</li>
        <li class="level2"><a href="alternative.html">Alternative</a></li>
        <li class="level2"><a href="applicative.html">Applicative</a></li>
        <li class="level2"><a href="applicativemonaderror.html">ApplicativeError and MonadError</a></li>
        <li class="level2"><a href="applicativetraverse.html">Applicative and Traversable Functors</a></li>
        <li class="level2"><a href="arrow.html">Arrow</a></li>
        <li class="level2"><a href="arrowchoice.html">Arrow Choice</a></li>
        <li class="level2"><a href="bifoldable.html">Bifoldable</a></li>
        <li class="level2"><a href="bifunctor.html">Bifunctor</a></li>
        <li class="level2"><a href="bimonad.html">Bimonad</a></li>
        <li class="level2"><a href="comonad.html">Comonad</a></li>
        <li class="level2"><a href="contravariant.html">Contravariant</a></li>
        <li class="level2"><a href="contravariantmonoidal.html">Contravariant Monoidal</a></li>
        <li class="level2"><a href="eq.html">Eq</a></li>
        <li class="level2"><a href="foldable.html">Foldable</a></li>
        <li class="level2"><a href="functor.html">Functor</a></li>
        <li class="level2"><a href="invariant.html">Invariant</a></li>
        <li class="level2"><a href="invariantmonoidal.html">Invariant Monoidal</a></li>
        <li class="level2"><a href="lawtesting.html">Law testing</a></li>
        <li class="level2 active"><a href="#">Monad</a></li>
        <li class="level2"><a href="monoid.html">Monoid</a></li>
        <li class="level2"><a href="monoidk.html">MonoidK</a></li>
        <li class="level2"><a href="nonemptytraverse.html">NonEmptyTraverse</a></li>
        <li class="level2"><a href="parallel.html">Parallel</a></li>
        <li class="level2"><a href="reducible.html">Reducible</a></li>
        <li class="level2"><a href="semigroup.html">Semigroup</a></li>
        <li class="level2"><a href="semigroupk.html">SemigroupK</a></li>
        <li class="level2"><a href="show.html">Show</a></li>
        <li class="level2"><a href="traverse.html">Traverse</a></li>
        <li class="level1 nav-header">Data Types</li>
        <li class="level2"><a href="../datatypes/chain.html">Chain</a></li>
        <li class="level2"><a href="../datatypes/const.html">Const</a></li>
        <li class="level2"><a href="../datatypes/contt.html">ContT</a></li>
        <li class="level2"><a href="../datatypes/either.html">Either</a></li>
        <li class="level2"><a href="../datatypes/eithert.html">EitherT</a></li>
        <li class="level2"><a href="../datatypes/eval.html">Eval</a></li>
        <li class="level2"><a href="../datatypes/freeapplicative.html">Free Applicative</a></li>
        <li class="level2"><a href="../datatypes/freemonad.html">Free Monad</a></li>
        <li class="level2"><a href="../datatypes/functionk.html">FunctionK</a></li>
        <li class="level2"><a href="../datatypes/id.html">Id</a></li>
        <li class="level2"><a href="../datatypes/ior.html">Ior</a></li>
        <li class="level2"><a href="../datatypes/iort.html">IorT</a></li>
        <li class="level2"><a href="../datatypes/kleisli.html">Kleisli</a></li>
        <li class="level2"><a href="../datatypes/nel.html">NonEmptyList</a></li>
        <li class="level2"><a href="../datatypes/nested.html">Nested</a></li>
        <li class="level2"><a href="../datatypes/oneand.html">OneAnd</a></li>
        <li class="level2"><a href="../datatypes/optiont.html">OptionT</a></li>
        <li class="level2"><a href="../datatypes/state.html">State</a></li>
        <li class="level2"><a href="../datatypes/validated.html">Validated</a></li>
        <li class="level2"><a href="../datatypes/writer.html">Writer</a></li>
        <li class="level2"><a href="../datatypes/writert.html">WriterT</a></li>
        <li class="level2"><a href="../datatypes/statet.html">StateT</a></li>
      </ul>

      <ul class="nav-list">
        <li class="level1 nav-header">Related Projects</li>
        
          <li class="level2"><a href="https://typelevel.org/cats-effect/">cats-effect</a></li>
        
          <li class="level2"><a href="https://typelevel.org/mouse">Mouse</a></li>
        
          <li class="level2"><a href="https://github.com/typelevel/discipline/">discipline</a></li>
        
      </ul>

    </nav>

    <div id="container">

      <nav id="page-nav">
        <p class="header"><a href="#">Monad</a></p>

        <ul class="nav-list">
          <li class="level1"><a href="#monad-instances">Monad instances</a></li>
          <li class="level1"><a href="#flatmap">flatMap</a></li>
          <li class="level1"><a href="#tailrecm">tailRecM</a></li>
          <li class="level1"><a href="#ifm">ifM</a></li>
          <li class="level1"><a href="#composition">Composition</a></li>
          <li class="level1"><a href="#flatmap-a-weakened-monad">FlatMap - a weakened Monad</a></li>
        </ul>

        <p class="footer"></p>
      </nav>

      <main class="content">

        <h1 id="monad" class="title">Monad</h1>
        <p>API Documentation: <a href="https://www.javadoc.io/doc/org.typelevel/cats-docs_2.13/1.6.0/cats/Monad.html">Monad</a></p>
        <p><code>Monad</code> extends the <a href="applicative.html"><code>Applicative</code></a> type class with a
        new function <code>flatten</code>. Flatten takes a value in a nested context (eg.
        <code>F[F[A]]</code> where F is the context) and &quot;joins&quot; the contexts together so
        that we have a single context (ie. <code>F[A]</code>).</p>
        <p>The name <code>flatten</code> should remind you of the functions of the same name on many
        classes in the standard library.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">Option</span><span>(</span><span class="type-name">Option</span><span>(</span><span class="number-literal">1</span><span>)).</span><span class="identifier">flatten</span><span>
</span><span class="comment">// res0: Option[Int] = Some(value = 1)
</span><span class="type-name">Option</span><span>(</span><span class="type-name">None</span><span>).</span><span class="identifier">flatten</span><span>
</span><span class="comment">// res1: Option[Nothing] = None
</span><span class="type-name">List</span><span>(</span><span class="type-name">List</span><span>(</span><span class="number-literal">1</span><span>),</span><span class="type-name">List</span><span>(</span><span class="number-literal">2</span><span>,</span><span class="number-literal">3</span><span>)).</span><span class="identifier">flatten</span><span>
</span><span class="comment">// res2: List[Int] = List(1, 2, 3)</span></code></pre>
        
        <h3 id="monad-instances" class="section">Monad instances<a class="anchor-link right" href="#monad-instances"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p>If <code>Applicative</code> is already present and <code>flatten</code> is well-behaved,
        extending the <code>Applicative</code> to a <code>Monad</code> is trivial. To provide evidence
        that a type belongs in the <code>Monad</code> type class, cats&#39; implementation
        requires us to provide an implementation of <code>pure</code> (which can be reused
        from <code>Applicative</code>) and <code>flatMap</code>.</p>
        <p>We can use <code>flatten</code> to define <code>flatMap</code>: <code>flatMap</code> is just <code>map</code>
        followed by <code>flatten</code>. Conversely, <code>flatten</code> is just <code>flatMap</code> using
        the identity function <code>x =&gt; x</code> (i.e. <code>flatMap(_)(x =&gt; x)</code>).</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">optionMonad</span><span>(</span><span class="keyword">implicit</span><span> </span><span class="identifier">app</span><span>: </span><span class="type-name">Applicative</span><span>[</span><span class="type-name">Option</span><span>]) =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Monad</span><span>[</span><span class="type-name">Option</span><span>] {
    </span><span class="comment">// Define flatMap using Option&#39;s flatten method
</span><span>    </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">flatMap</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">Option</span><span>[</span><span class="type-name">A</span><span>])(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">Option</span><span>[</span><span class="type-name">B</span><span>]): </span><span class="type-name">Option</span><span>[</span><span class="type-name">B</span><span>] =
      </span><span class="identifier">app</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">fa</span><span>)(</span><span class="identifier">f</span><span>).</span><span class="identifier">flatten</span><span>
    </span><span class="comment">// Reuse this definition from Applicative.
</span><span>    </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">pure</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">a</span><span>: </span><span class="type-name">A</span><span>): </span><span class="type-name">Option</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="identifier">app</span><span>.</span><span class="identifier">pure</span><span>(</span><span class="identifier">a</span><span>)

    </span><span class="annotation">@annotation</span><span>.</span><span class="identifier">tailrec</span><span>
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">tailRecM</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">init</span><span>: </span><span class="type-name">A</span><span>)(</span><span class="identifier">fn</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">Option</span><span>[</span><span class="type-name">Either</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>]]): </span><span class="type-name">Option</span><span>[</span><span class="type-name">B</span><span>] =
      </span><span class="identifier">fn</span><span>(</span><span class="identifier">init</span><span>) </span><span class="keyword">match</span><span> {
        </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span> =&gt; </span><span class="type-name">None</span><span>
        </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="type-name">Right</span><span>(</span><span class="identifier">b</span><span>)) =&gt; </span><span class="type-name">Some</span><span>(</span><span class="identifier">b</span><span>)
        </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="type-name">Left</span><span>(</span><span class="identifier">a</span><span>)) =&gt; </span><span class="identifier">tailRecM</span><span>(</span><span class="identifier">a</span><span>)(</span><span class="identifier">fn</span><span>)
      }
  }</span></code></pre>
        
        <h3 id="flatmap" class="section">flatMap<a class="anchor-link right" href="#flatmap"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p><code>flatMap</code> is often considered to be the core function of <code>Monad</code>, and Cats
        follows this tradition by providing implementations of <code>flatten</code> and <code>map</code>
        derived from <code>flatMap</code> and <code>pure</code>.</p>
        <p>Part of the reason for this is that name <code>flatMap</code> has special significance in
        scala, as for-comprehensions rely on this method to chain together operations
        in a monadic context.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">scala</span><span>.</span><span class="identifier">reflect</span><span>.</span><span class="identifier">runtime</span><span>.</span><span class="identifier">universe</span><span>

</span><span class="identifier">universe</span><span>.</span><span class="identifier">reify</span><span>(
  </span><span class="keyword">for</span><span> {
    </span><span class="identifier">x</span><span> &lt;- </span><span class="type-name">Some</span><span>(</span><span class="number-literal">1</span><span>)
    </span><span class="identifier">y</span><span> &lt;- </span><span class="type-name">Some</span><span>(</span><span class="number-literal">2</span><span>)
  } </span><span class="keyword">yield</span><span> </span><span class="identifier">x</span><span> + </span><span class="identifier">y</span><span>
).</span><span class="identifier">tree</span><span>
</span><span class="comment">// res3: universe.Tree = Apply(
//   fun = Select(
//     qualifier = Apply(
//       fun = Select(qualifier = Ident(name = Some), name = apply),
//       args = List(Literal(value = Constant(value = 1)))
//     ),
//     name = flatMap
//   ),
//   args = List(
//     Function(
//       vparams = List(
//         ValDef(
//           mods = Modifiers(
//             flags = 8192L,
//             privateWithin = ,
//             annotations = List()
//           ),
//           name = x,
//           tpt = &lt;type ?&gt;,
//           rhs = &lt;empty&gt;
//         )
//       ),
//       body = Apply(
//         fun = Select(
//           qualifier = Apply(
//             fun = Select(qualifier = Ident(name = Some), name = apply),
//             args = List(Literal(value = Constant(value = 2)))
//           ),
//           name = map
//         ),
//         args = List(
//           Function(
//             vparams = List(
//               ValDef(
//                 mods = Modifiers(
//                   flags = 8192L,
//                   privateWithin = ,
//                   annotations = List()
//                 ),
//                 name = y,
//                 tpt = &lt;type ?&gt;,
//                 rhs = &lt;empty&gt;
//               )
//             ),
//             body = Apply(
//               fun = Select(qualifier = Ident(name = x), name = $plus),
//               args = List(Ident(name = y))
//             )
//           )
// ...</span></code></pre>
        
        <h3 id="tailrecm" class="section">tailRecM<a class="anchor-link right" href="#tailrecm"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p>In addition to requiring <code>flatMap</code> and <code>pure</code>, Cats has chosen to require
        <code>tailRecM</code> which encodes stack safe monadic recursion, as described in
        <a href="http://functorial.com/stack-safety-for-free/index.pdf">Stack Safety for Free</a> by
        Phil Freeman. Because monadic recursion is so common in functional programming but
        is not stack safe on the JVM, Cats has chosen to require this method of all monad implementations
        as opposed to just a subset. All functions requiring monadic recursion in Cats do so via
        <code>tailRecM</code>.</p>
        <p>An example <code>Monad</code> implementation for <code>Option</code> is shown below. Note the tail recursive
        and therefore stack safe implementation of <code>tailRecM</code>.</p>
        <pre><code class="nohighlight"><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">Monad</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">scala</span><span>.</span><span class="identifier">annotation</span><span>.</span><span class="identifier">tailrec</span><span>

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">optionMonad</span><span> = </span><span class="keyword">new</span><span> </span><span class="type-name">Monad</span><span>[</span><span class="type-name">Option</span><span>] {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">flatMap</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">Option</span><span>[</span><span class="type-name">A</span><span>])(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">Option</span><span>[</span><span class="type-name">B</span><span>]): </span><span class="type-name">Option</span><span>[</span><span class="type-name">B</span><span>] = </span><span class="identifier">fa</span><span>.</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">f</span><span>)
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">pure</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">a</span><span>: </span><span class="type-name">A</span><span>): </span><span class="type-name">Option</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="type-name">Some</span><span>(</span><span class="identifier">a</span><span>)

  </span><span class="annotation">@tailrec</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">tailRecM</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">a</span><span>: </span><span class="type-name">A</span><span>)(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">Option</span><span>[</span><span class="type-name">Either</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>]]): </span><span class="type-name">Option</span><span>[</span><span class="type-name">B</span><span>] = </span><span class="identifier">f</span><span>(</span><span class="identifier">a</span><span>) </span><span class="keyword">match</span><span> {
    </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span>              =&gt; </span><span class="type-name">None</span><span>
    </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="type-name">Left</span><span>(</span><span class="identifier">nextA</span><span>)) =&gt; </span><span class="identifier">tailRecM</span><span>(</span><span class="identifier">nextA</span><span>)(</span><span class="identifier">f</span><span>) </span><span class="comment">// continue the recursion
</span><span>    </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="type-name">Right</span><span>(</span><span class="identifier">b</span><span>))    =&gt; </span><span class="type-name">Some</span><span>(</span><span class="identifier">b</span><span>)            </span><span class="comment">// recursion done
</span><span>  }
}</span></code></pre>
        <p>More discussion about <code>tailRecM</code> can be found in the <a href="../faq.html#what-is-tailrecm">FAQ</a>.</p>
        
        <h3 id="ifm" class="section">ifM<a class="anchor-link right" href="#ifm"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p><code>Monad</code> provides the ability to choose later operations in a sequence based on
        the results of earlier ones. This is embodied in <code>ifM</code>, which lifts an <code>if</code>
        statement into the monadic context.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>

</span><span class="type-name">Monad</span><span>[</span><span class="type-name">List</span><span>].</span><span class="identifier">ifM</span><span>(</span><span class="type-name">List</span><span>(</span><span class="boolean-literal">true</span><span>, </span><span class="boolean-literal">false</span><span>, </span><span class="boolean-literal">true</span><span>))(</span><span class="identifier">ifTrue</span><span> = </span><span class="type-name">List</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="number-literal">2</span><span>), </span><span class="identifier">ifFalse</span><span> = </span><span class="type-name">List</span><span>(</span><span class="number-literal">3</span><span>, </span><span class="number-literal">4</span><span>))
</span><span class="comment">// res5: List[Int] = List(1, 2, 3, 4, 1, 2)</span></code></pre>
        
        <h3 id="composition" class="section">Composition<a class="anchor-link right" href="#composition"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p>Unlike <a href="functor.html"><code>Functor</code>s</a> and <a href="applicative.html"><code>Applicative</code>s</a>,
        not all <code>Monad</code>s compose. This means that even if <code>M[_]</code> and <code>N[_]</code> are
        both <code>Monad</code>s, <code>M[N[_]]</code> is not guaranteed to be a <code>Monad</code>.</p>
        <p>However, many common cases do. One way of expressing this is to provide
        instructions on how to compose any outer monad (<code>F</code> in the following
        example) with a specific inner monad (<code>Option</code> in the following
        example).</p>
        <p><em>Note</em>: the example below assumes usage of the <a href="https://github.com/typelevel/kind-projector">kind-projector compiler plugin</a> and will not compile if it is not being used in a project.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">Monad</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">OptionT</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>], </span><span class="type-name">A</span><span>](</span><span class="identifier">value</span><span>: </span><span class="type-name">F</span><span>[</span><span class="type-name">Option</span><span>[</span><span class="type-name">A</span><span>]])

</span><span class="keyword">implicit</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">optionTMonad</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]](</span><span class="keyword">implicit</span><span> </span><span class="type-name">F</span><span>: </span><span class="type-name">Monad</span><span>[</span><span class="type-name">F</span><span>]): </span><span class="type-name">Monad</span><span>[</span><span class="type-name">OptionT</span><span>[</span><span class="type-name">F</span><span>, *]] = {
  </span><span class="keyword">new</span><span> </span><span class="type-name">Monad</span><span>[</span><span class="type-name">OptionT</span><span>[</span><span class="type-name">F</span><span>, *]] {
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">pure</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">a</span><span>: </span><span class="type-name">A</span><span>): </span><span class="type-name">OptionT</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">A</span><span>] = </span><span class="type-name">OptionT</span><span>(</span><span class="type-name">F</span><span>.</span><span class="identifier">pure</span><span>(</span><span class="type-name">Some</span><span>(</span><span class="identifier">a</span><span>)))
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">flatMap</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">OptionT</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">A</span><span>])(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">OptionT</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">B</span><span>]): </span><span class="type-name">OptionT</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">B</span><span>] =
      </span><span class="type-name">OptionT</span><span> {
        </span><span class="type-name">F</span><span>.</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">fa</span><span>.</span><span class="identifier">value</span><span>) {
          </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span> =&gt; </span><span class="type-name">F</span><span>.</span><span class="identifier">pure</span><span>(</span><span class="type-name">None</span><span>)
          </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="identifier">a</span><span>) =&gt; </span><span class="identifier">f</span><span>(</span><span class="identifier">a</span><span>).</span><span class="identifier">value</span><span>
        }
      }

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">tailRecM</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">a</span><span>: </span><span class="type-name">A</span><span>)(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">OptionT</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Either</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>]]): </span><span class="type-name">OptionT</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">B</span><span>] =
      </span><span class="type-name">OptionT</span><span> {
        </span><span class="type-name">F</span><span>.</span><span class="identifier">tailRecM</span><span>(</span><span class="identifier">a</span><span>)(</span><span class="identifier">a0</span><span> =&gt; </span><span class="type-name">F</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">f</span><span>(</span><span class="identifier">a0</span><span>).</span><span class="identifier">value</span><span>) {
          </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span> =&gt; </span><span class="type-name">Either</span><span>.</span><span class="identifier">right</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">Option</span><span>[</span><span class="type-name">B</span><span>]](</span><span class="type-name">None</span><span>)
          </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="identifier">b0</span><span>) =&gt; </span><span class="identifier">b0</span><span>.</span><span class="identifier">map</span><span>(</span><span class="type-name">Some</span><span>(</span><span class="identifier">_</span><span>))
        })
      }
  }
}</span></code></pre>
        <p>This sort of construction is called a monad transformer.</p>
        <p>Cats has an <a href="../datatypes/optiont.html"><code>OptionT</code></a> monad transformer, which adds a lot of useful functions to the simple implementation above.</p>
        
        <h2 id="flatmap-a-weakened-monad" class="section">FlatMap - a weakened Monad<a class="anchor-link right" href="#flatmap-a-weakened-monad"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>A closely related type class is <code>FlatMap</code> which is identical to <code>Monad</code>, minus the <code>pure</code>
        method. Indeed in Cats <code>Monad</code> is a subclass of <code>FlatMap</code> (from which it gets <code>flatMap</code>)
        and <code>Applicative</code> (from which it gets <code>pure</code>).</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">trait</span><span> </span><span class="type-name">FlatMap</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]] </span><span class="keyword">extends</span><span> </span><span class="type-name">Apply</span><span>[</span><span class="type-name">F</span><span>] {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">flatMap</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">fa</span><span>: </span><span class="type-name">F</span><span>[</span><span class="type-name">A</span><span>])(</span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">F</span><span>[</span><span class="type-name">B</span><span>]): </span><span class="type-name">F</span><span>[</span><span class="type-name">B</span><span>]
}

</span><span class="keyword">trait</span><span> </span><span class="type-name">Monad</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]] </span><span class="keyword">extends</span><span> </span><span class="type-name">FlatMap</span><span>[</span><span class="type-name">F</span><span>] </span><span class="keyword">with</span><span> </span><span class="type-name">Applicative</span><span>[</span><span class="type-name">F</span><span>]</span></code></pre>
        <p>The laws for <code>FlatMap</code> are just the laws of <code>Monad</code> that don&#39;t mention <code>pure</code>.</p>
        <p>One of the motivations for <code>FlatMap</code>&#39;s existence is that some types have <code>FlatMap</code> instances but not
        <code>Monad</code> - one example is <code>Map[K, *]</code>. Consider the behavior of <code>pure</code> for <code>Map[K, A]</code>. Given
        a value of type <code>A</code>, we need to associate some arbitrary <code>K</code> to it but we have no way of doing that.</p>
        <p>However, given existing <code>Map[K, A]</code> and <code>Map[K, B]</code> (or <code>Map[K, A =&gt; B]</code>), it is straightforward to
        pair up (or apply functions to) values with the same key. Hence <code>Map[K, *]</code> has an <code>FlatMap</code> instance.</p>

        <hr style="margin-top: 30px"/>
        <footer style="font-size: 90%; text-align: center">
          cats is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://opensource.org/licenses/MIT">MIT</a> license.
        </footer>

      </main>

    </div>

  </body>
</html>
